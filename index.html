<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase ì„¤ì • í™•ì¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 2rem;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .status-box {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 600;
        }
        .success {
            background-color: #d1fae5; /* green-100 */
            color: #065f46; /* green-900 */
        }
        .error {
            background-color: #fee2e2; /* red-100 */
            color: #991b1b; /* red-900 */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">Firebase ì´ˆê¸°í™” ìƒíƒœ</h1>
        <div id="status-message" class="status-box">ì´ˆê¸°í™” ì¤‘...</div>
        <div id="user-info" class="mt-4 p-4 bg-gray-50 rounded-lg border">
            <h2 class="font-semibold text-lg mb-2 text-gray-700">ì‚¬ìš©ì ì¸ì¦ ì •ë³´</h2>
            <p class="text-sm text-gray-600">User ID: <span id="user-id" class="font-mono text-xs bg-gray-200 px-2 py-0.5 rounded">...</span></p>
            <p class="text-sm text-gray-600 mt-1">Provider ID: <span id="provider-id" class="font-mono text-xs bg-gray-200 px-2 py-0.5 rounded">...</span></p>
        </div>
    </div>

    <script type="module">
        // í•„ìš”í•œ Firebase ëª¨ë“ˆì„ CDNì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const statusMessageEl = document.getElementById('status-message');
        const userIdEl = document.getElementById('user-id');
        const providerIdEl = document.getElementById('provider-id');

        let app;
        let auth;

        /**
         * ìƒíƒœ ë©”ì‹œì§€ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {string} message í‘œì‹œí•  ë©”ì‹œì§€
         * @param {boolean} isError ì˜¤ë¥˜ ì—¬ë¶€
         */
        function updateStatus(message, isError = false) {
            statusMessageEl.textContent = message;
            statusMessageEl.className = 'status-box ' + (isError ? 'error' : 'success');
        }

        /**
         * Firebase ì„¤ì •ì„ ë¡œë“œí•˜ê³  ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         */
        async function initializeFirebase() {
            try {
                // 1. ì „ì—­ ë³€ìˆ˜ì—ì„œ Firebase ì„¤ì • ê°€ì ¸ì˜¤ê¸° (ì˜¤ë¥˜ì˜ ì£¼ìš” ì›ì¸ í•´ê²°)
                // ì „ì—­ ë³€ìˆ˜ __firebase_configê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                if (typeof __firebase_config === 'undefined' || !__firebase_config) {
                    throw new Error("ì „ì—­ ë³€ìˆ˜ '__firebase_config'ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
                }

                const firebaseConfig = JSON.parse(__firebase_config);
                
                // ì„¤ì • ê°ì²´ê°€ ìœ íš¨í•œì§€ í™•ì¸í•©ë‹ˆë‹¤.
                if (!firebaseConfig || typeof firebaseConfig !== 'object' || !firebaseConfig.apiKey) {
                    throw new Error("íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì • ê°ì²´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. JSON.parse ì˜¤ë¥˜ ë˜ëŠ” í•„ìˆ˜ í•„ë“œ ëˆ„ë½.");
                }

                // 2. Firebase ì•± ì´ˆê¸°í™”
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                
                updateStatus("âœ… Firebase ì•± ì´ˆê¸°í™” ì„±ê³µ. ì¸ì¦ì„ ì‹œë„í•©ë‹ˆë‹¤...");

                // 3. ì¸ì¦ ìƒíƒœ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // ì¸ì¦ ì„±ê³µ
                        userIdEl.textContent = user.uid;
                        providerIdEl.textContent = user.isAnonymous ? "anonymous" : (user.providerData[0]?.providerId || 'custom-token');
                        updateStatus("âœ¨ Firebase ì´ˆê¸°í™” ë° ì¸ì¦ ì„±ê³µ! User ID í™•ì¸ë¨.");
                    } else {
                        // ì¸ì¦ ì‹¤íŒ¨ (ì´ˆê¸° ìƒíƒœì´ê±°ë‚˜ ë¡œê·¸ì•„ì›ƒë¨)
                        userIdEl.textContent = "N/A";
                        providerIdEl.textContent = "N/A";
                        updateStatus("âš ï¸ ì¸ì¦ ìƒíƒœ ë³€í™” ê°ì§€: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. í† í° ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤...", true);
                        attemptAuth();
                    }
                });

                // 4. ì¸ì¦ ì‹œë„ í•¨ìˆ˜
                async function attemptAuth() {
                    try {
                        // ì„¸ì…˜ ì§€ì†ì„± ì„¤ì • (ì„ íƒì ì´ì§€ë§Œ ê¶Œì¥ë¨)
                        await setPersistence(auth, browserSessionPersistence);
                        
                        // ì „ì—­ ë³€ìˆ˜ __initial_auth_tokenì´ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            // ì»¤ìŠ¤í…€ í† í°ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„
                            await signInWithCustomToken(auth, __initial_auth_token);
                            updateStatus("ğŸ‰ ì»¤ìŠ¤í…€ í† í°ìœ¼ë¡œ ë¡œê·¸ì¸ ì™„ë£Œ.");
                        } else {
                            // í† í°ì´ ì—†ìœ¼ë©´ ìµëª… ë¡œê·¸ì¸ ì‹œë„
                            await signInAnonymously(auth);
                            updateStatus("ğŸ‘¤ ìµëª… ë¡œê·¸ì¸ ì™„ë£Œ (ì´ˆê¸° í† í° ì—†ìŒ).");
                        }
                    } catch (authError) {
                        updateStatus(`âŒ Firebase ì¸ì¦ ì‹¤íŒ¨: ${authError.message}`, true);
                        console.error("Firebase ì¸ì¦ ì˜¤ë¥˜:", authError);
                    }
                }

                // ìµœì´ˆ ì¸ì¦ ì‹œë„ (onAuthStateChangedê°€ ì´ë¥¼ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆì§€ë§Œ, ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œ)
                // Note: onAuthStateChanged listener handles the actual UI update.
                if (!auth.currentUser) {
                     attemptAuth();
                }

            } catch (error) {
                // ì„¤ì • ë¡œë“œ ë˜ëŠ” ì´ˆê¸°í™” ì¤‘ ë°œìƒí•œ ëª¨ë“  ì˜¤ë¥˜ ì²˜ë¦¬
                updateStatus(`âŒ Firebase ì´ˆê¸°í™” ì˜¤ë¥˜: ${error.message}`, true);
                console.error("ì´ˆê¸°í™” í”„ë¡œì„¸ìŠ¤ ì˜¤ë¥˜:", error);

                // íŠ¹íˆ êµ¬ì„± ì˜¤ë¥˜ì¸ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ëª…í™•íˆ ì•Œë ¤ì¤ë‹ˆë‹¤.
                if (error.message.includes('__firebase_config')) {
                    userIdEl.textContent = "Error";
                    providerIdEl.textContent = "Error";
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Firebase ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
        window.onload = initializeFirebase;
    </script>
</body>
</html>
